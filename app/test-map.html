<!DOCTYPE html>
<html>
  <head>
    <title>Anime Spot Map</title>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      // スプレッドシートの読み込み（公開URLを後で登録）
      async function fetchSpots() {
        const sheetId = '（SHEET_ID_SPOTS_DEVを入力）';  // SHEET_ID_SPOTS_DEV
        const sheetName = '（SHEET_NAME_SPOTS_DEVを入力）'; // SHEET_NAME_SPOTS_DEV
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
        const res = await fetch(url);
        const text = await res.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;

        return rows.map(row => ({
          name: row.c[0]?.v || '',
          lat: parseFloat(row.c[1]?.v),
          lng: parseFloat(row.c[2]?.v),
          description: row.c[3]?.v || ''
        }));
      }

      // マップ初期化処理
      async function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 35.6982, lng: 139.773 },
          zoom: 14,
        });

        const spots = await fetchSpots();

        spots.forEach((spot) => {
          const marker = new google.maps.Marker({
            position: { lat: spot.lat, lng: spot.lng },
            map,
            title: spot.name
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `<strong>${spot.name}</strong><br>${spot.description}`
          });

          marker.addListener("click", () => {
            infoWindow.open(map, marker);
          });
        });
      }
    </script>

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=（APIキーを入力）&callback=initMap&language=en"
    ></script>
  </body>
</html>
