<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Anime Spot Map</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Google Maps JavaScript API Ë™≠„ÅøËæº„Åø -->
  <script
    //‚ÄªÊ≥®ÊÑèAPIÊàª„Åô„ÄÅlanguage=enËøΩÂä†
    src="https://maps.googleapis.com/maps/api/js?key=REMOVED_SECRET&callback=initMap&language=en" 
    async
    defer
  ></script>

  <script>
    let map;

    // ‚úÖ ÂàùÊúüÂåñÔºö„Éû„ÉÉ„ÉóË°®Á§∫Ôºã„Çπ„Éù„ÉÉ„ÉàÂèñÂæó
    async function initMap() {
      // 1. Âú∞Âõ≥„ÇíÂàùÊúüÂåñÔºàÊù±‰∫¨‰∏≠ÂøÉ„ÄÅ„Ç∫„Éº„É†13Ôºâ
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 35.6804, lng: 139.7690 }, // Êù±‰∫¨ÈßÖ„ÅÇ„Åü„Çä
        zoom: 13,
        mapTypeControl: false,
        fullscreenControl: false,
      });

      try {
        // 2. „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„Çâ„Çπ„Éù„ÉÉ„ÉàÊÉÖÂ†±„ÇíÂèñÂæó
        const response = await fetch('/api/spots');
        const spots = await response.json();

        console.log("üì¶ Fetched spots:", spots); // ‚úÖ „É≠„Ç∞Ë®≠Ë®àÔºàÂæå„ÅßÁ¢∫Ë™ç„Åó„ÇÑ„Åô„ÅÑÔºâ

        // 3. ÂêÑ„Çπ„Éù„ÉÉ„Éà„Å´„Éû„Éº„Ç´„ÉºÔºÜinfoWindow„ÇíËøΩÂä†
        spots.forEach((spot) => {
          addMarkerWithInfo(spot);
        });
      } catch (error) {
        console.error("‚ùå Failed to fetch spots:", error);
      }
    }

    // ‚úÖ Èñ¢Êï∞Ôºö„Éû„Éº„Ç´„Éº„Å®Âêπ„ÅçÂá∫„Åó„ÇíËøΩÂä†
    function addMarkerWithInfo(spot) {
      const marker = new google.maps.Marker({
        position: { lat: spot.lat, lng: spot.lng },
        map: map,
        title: spot.name,
      });

      const infoWindow = new google.maps.InfoWindow({
        content: `
          <div style="max-width:200px;">
            <strong>${spot.name}</strong><br/>
            <span>${spot.description}</span>
          </div>
        `,
      });

      marker.addListener("click", () => {
        infoWindow.open(map, marker);
      });
    }
  </script>
</body>
</html>
