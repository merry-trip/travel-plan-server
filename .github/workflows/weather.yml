name: Daily Weather Logger

on:
  schedule:
    - cron: '0 21 * * *' # JST 6:00ÔºàUTC 21:00Ôºâ
  workflow_dispatch: # ‚úÖ ÊâãÂãïÂÆüË°å„ÇÇÂèØËÉΩ

jobs:
  log-weather:
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ „É™„Éù„Ç∏„Éà„É™„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        uses: actions/checkout@v3

      - name: üü¢ Node.js „Çí„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÔºàv20Ôºâ
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: üì¶ ‰æùÂ≠ò„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´Ôºàapp„Éá„Ç£„É¨„ÇØ„Éà„É™Ôºâ
        working-directory: app
        run: npm install

      - name: üîê GoogleË™çË®º„Éï„Ç°„Ç§„É´Ôºàcredentials.prod.jsonÔºâ„ÇíÁîüÊàê
        working-directory: app
        run: |
          echo "${{ secrets.GOOGLE_CREDENTIALS_JSON_PROD }}" > credentials.prod.json

      - name: ‚òÅÔ∏è Â§©Ê∞ó„Éá„Éº„Çø„Çí„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´Ë®òÈå≤
        working-directory: app
        env:
          APP_ENV: prod
          OPENWEATHER_API_KEY_PROD: ${{ secrets.OPENWEATHER_API_KEY_PROD }}
          SHEET_ID_WEATHER_PROD: ${{ secrets.SHEET_ID_WEATHER_PROD }}
          SHEET_NAME_WEATHER_PROD: ${{ secrets.SHEET_NAME_WEATHER_PROD }}
          GOOGLE_CREDENTIALS_JSON_PROD: ${{ secrets.GOOGLE_CREDENTIALS_JSON_PROD }}
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
          GMAIL_TO: ${{ secrets.GMAIL_TO }}
        run: node domains/weather/writeToSheet.js

