name: Daily Weather Logger

on:
  schedule:
    - cron: '0 0 * * *' # æ¯Žæ—¥0æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“9æ™‚ï¼‰ã«å®Ÿè¡Œ
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  log-weather:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v3

      - name: ðŸŸ¢ Node.js ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: ðŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        working-directory: app
        run: npm install

      - name: ðŸ” ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‹ã‚‰èªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
        working-directory: app
        run: |
          echo "${{ secrets.GOOGLE_CREDENTIALS_JSON_PROD }}" > credentials.prod.json

      - name: ðŸ“Š å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²
        working-directory: app    
        env:
          APP_ENV: prod
          OPENWEATHER_API_KEY_PROD: ${{ secrets.OPENWEATHER_API_KEY_PROD }}
          SHEET_ID_WEATHER_PROD: ${{ secrets.SHEET_ID_WEATHER_PROD }}
          SHEET_NAME_WEATHER_PROD: ${{ secrets.SHEET_NAME_WEATHER_PROD }}
          GOOGLE_CREDENTIALS_JSON_PROD: ${{ secrets.GOOGLE_CREDENTIALS_JSON_PROD }} 
        run: node test-write-to-sheet.js